package upei.webserver;
import upei.api.*;

import java.lang.reflect.Method;

import org.simpleframework.http.Request;
import org.simpleframework.http.Response;
import org.simpleframework.http.core.Container;

public class RouteConfig  implements Container {

	private Request request;
	private Response response;

	
	@Override
	public void handle(Request request, Response response) {
		this.request = request;
		this.response = response;
		
		String path = request.getPath().getPath();
		
		try {
			configureRoustes(path);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	public void configureRoustes(String path) {
		if (path.startsWith("/adicionarProduto"))
			mapper(new SprintsAPI(this.request, this.response));
	}
	
	
	public void mapper(Object controller) throws Exception {
		String httpMethod = request.getMethod();
		
		if (httpMethod.equals(HTTPMethod.POST)) {
			Method postMethod = controller.getClass().getMethod("post");
			postMethod.invoke(controller);
		}
		else {
			Method getMethod = controller.getClass().getMethod("get");
			getMethod.invoke(controller);
		}
	}
}

enum HTTPMethod {
	GET, POST
}